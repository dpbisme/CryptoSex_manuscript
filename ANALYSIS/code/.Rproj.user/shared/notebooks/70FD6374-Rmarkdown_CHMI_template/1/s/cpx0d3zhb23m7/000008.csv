"0","log2.cpm.filtered.norm <- t(cpm(myDGEList.filtered.norm, log=TRUE))"
"0","log2.cpm.filtered.norm.batchCorrected <- empiricalBayesLM("
"0","  log2.cpm.filtered.norm, "
"0","  removedCovariates = targets$batch, "
"0","  fitToSamples = targets$sex_stage==""asexual"")$adjustedData;"
"0","pca.res <- prcomp(log2.cpm.filtered.norm.batchCorrected, scale.=F, retx=T)"
"0","pc.var<-pca.res$sdev^2"
"0","pc.per<-round(pc.var/sum(pc.var)*100, 1)"
"0","pca.res.df <- as_tibble(pca.res$x)"
"0","ggplot(pca.res.df, aes(x=PC1, y=PC2, color=sex, shape=origin)) +"
"0","  geom_point(size=6) +"
"0","  theme(legend.position=""right"") + "
"0","  xlab(paste0(""PC1 ("",pc.per[1],""%"","")"")) + "
"0","  ylab(paste0(""PC2 ("",pc.per[2],""%"","")"")) + "
"0","  labs(title=""PCA showing all datasets combined"","
"0","       subtitle = ""Principal component analysis (PCA) \nshowing all samples after batch correction. \nClear separation based on stage and sex. \nThis plot corresponds to Figure 3D in the manuscript."") +"
"0","  theme_bw() + "
"0","  theme(axis.text=element_text(size=16),"
"0","        axis.title=element_text(size=18),"
"0","        legend.text=element_text(size=14),"
"0","        legend.title=element_text(size=16, face=""bold""),"
"0","        plot.title = element_text(size=20, face=""bold""))"
